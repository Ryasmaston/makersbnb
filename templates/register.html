{% extends "base.html" %} {% block title %}Register | MakersBnB{% endblock %} {%
block content %}
<div class="flex items-center justify-center h-[calc(100vh-76px)]">
    <div class="flex flex-col items-center translate-y-[calc(-76px/2)]">
        <div class="card w-100 mt-16 shadow-2xl rounded-2xl">
            <header>
                <h2>Register your account</h2>
                <p>Enter your details below to register to MakersBnB</p>
            </header>
            <section>
                <form class="form grid gap-6" action="/register" method="POST">
                    <div class="grid gap-2">
                        <label for="name">Name</label>

                        <input
                            type="text"
                            id="name"
                            name="name"
                            value="{{ name or '' }}"
                            required
                        />
                    </div>
                    <div class="grid gap-2">
                        <label for="email">Email</label>
                        <input
                            type="email"
                            id="email"
                            name="email"
                            value="{{ email or '' }}"
                            required
                        />
                    </div>
                    <div class="grid gap-2">
                        <div class="flex items-center justify-between gap-2">
                            <label for="password">Password</label>
                            <span id="password_valid_message" class="text-sm text-right"></span>
                        </div>
                        <input
                            type="password"
                            id="password"
                            name="password"
                            required
                        />
                    </div>
                    <div class="grid gap-2">
                        <div class="flex items-center justify-between gap-2">
                            <label for="confirm_password"
                                >Confirm Password</label
                            >

                            <span id="password_message" class="text-sm"></span>
                        </div>
                        <input
                            type="password"
                            id="confirm_password"
                            name="confirm_password"
                            required
                        />
                    </div>
                    <div class="flex flex-col gap-2">
                        <button
                            type="submit"
                            id="submit_button"
                            class="btn w-full"
                        >
                            Create Account
                        </button>
                    </div>
                </form>
            </section>
        </div>
    </div>
</div>

<script>
    const password = document.getElementById("password");
    const confirm_password = document.getElementById("confirm_password");
    const valid_message = document.getElementById("password_valid_message");
    const message = document.getElementById("password_message");
    const submitButton = document.getElementById("submit_button");

    // Regular Expression to check for the required complexity:
    // 1. Minimum 8 characters total:                  .{8,}
    // 2. At least one digit (0-9):                    (?=.*\d)
    // 3. At least one special character (non-word, non-space): (?=.*[^\w\s])
    const passwordRegex = /^(?=.*\d)(?=.*[^\w\s]).{8,}$/;

    // Main function to check both conditions and control the submit button
    function updateSubmitButtonState() {
        const isPasswordValid = checkPasswordComplexity();
        const doPasswordsMatch = checkPasswordsMatch();

        submitButton.disabled = !(isPasswordValid && doPasswordsMatch);
    }

    function checkPasswordComplexity() {
        const passwordValue = password.value;
        const isValid = passwordRegex.test(passwordValue);

        if (isValid) {
            valid_message.textContent = "Valid password!";
            valid_message.className = passwordValue.length > 0 ? "text-sm text-green-500" : "text-sm";
        } else {
            valid_message.textContent = "Password must be at least 8 characters long, contain 1 number, and 1 symbol.";
            valid_message.className = passwordValue.length > 0 ? "text-xs text-red-500 text-right" : "text-xs text-gray-500 text-right";
        }
        return isValid;
    }

    function checkPasswordsMatch() {
        if (password.value === "" && confirm_password.value === "") {
            message.textContent = "";
            return false;
        }

        if (password.value === confirm_password.value) {
            message.textContent = "Passwords match!";
            message.className = "text-sm text-green-500";
            return true;
        } else {
            message.textContent = "Passwords do not match.";
            message.className = "text-sm text-red-500";
            return false;
        }
    }

    password.addEventListener("input", updateSubmitButtonState);
    confirm_password.addEventListener("input", updateSubmitButtonState);

    updateSubmitButtonState();
</script>

{% endblock %}
