<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Bookings | MakersBnB</title>
        <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    </head>
    {% extends "base.html" %} {% block title %}Bookings | MakersBnB{% endblock %} {%
    block content %}
    <div class="flex items-center justify-center h-[calc(100vh-76px)] overflow-y-auto">
        <div class="flex flex-col items-center translate-y-[calc(-76px/2)] w-full px-6">
            <div class="mb-10 flex flex-col align-center">
                <h2 class="text-5xl font-bold text-center mb-8">Bookings</h2>
            </div>

            <section class="w-full max-w-5xl mb-12">
                <h3 class="text-3xl font-semibold mb-6 text-center">Bookings I Have Made</h3>

                {% if outbound_bookings %}
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    {% for booking in outbound_bookings %}
                    <div
                        class="card flex flex-col justify-between p-6 shadow-2xl rounded-2xl transition-transform duration-200 hover:-translate-y-1 hover:scale-[1.01]"
                    >
                        <header class="mb-3">
                            <h4 class="text-xl font-bold mb-1">
                                Booking #{{booking.id}}
                            </h4>
                            <p class="text-gray-600">
                                Listing ID: {{booking.listing_id}}
                            </p>
                        </header>

                        <section class="mb-4">
                            <p><strong>Start Date:</strong> {{booking.start_date}}</p>
                            <p><strong>End Date:</strong> {{booking.end_date}}</p>
                            <p><strong>Status:</strong>
                                <span class="
                                    {% if booking.status == 'confirmed' %}text-green-600{% elif booking.status == 'pending' %}text-yellow-600{% else %}text-red-600{% endif %}
                                    font-semibold
                                ">
                                    {{booking.status | capitalize}}
                                </span>
                            </p>
                        </section>

                        <footer class="mt-auto flex justify-end">
                            <button
                                class="btn-outline text-sm"
                                onclick="document.getElementById('booking-{{booking.id}}-dialog').showModal()"
                            >
                                View Details
                            </button>
                        </footer>
                    </div>

                    <dialog
                        id="booking-{{booking.id}}-dialog"
                        class="dialog max-w-[420px]"
                        onclick="if (event.target === this) this.close()"
                    >
                        <div class="p-6">
                            <header class="mb-4">
                                <h2 class="text-2xl font-semibold">Booking #{{booking.id}}</h2>
                            </header>
                            <section class="space-y-2">
                                <p><strong>Listing ID:</strong> {{booking.listing_id}}</p>
                                <p><strong>Guest ID:</strong> {{booking.guest_id}}</p>
                                <p><strong>Start Date:</strong> {{booking.start_date}}</p>
                                <p><strong>End Date:</strong> {{booking.end_date}}</p>
                                <p><strong>Status:</strong>
                                    <span class="
                                        {% if booking.status == 'confirmed' %}text-green-600{% elif booking.status == 'pending' %}text-yellow-600{% else %}text-red-600{% endif %}
                                        font-semibold
                                    ">
                                        {{booking.status | capitalize}}
                                    </span>
                                </p>
                            </section>
                            <footer class="mt-6 flex justify-end">
                                <button class="btn" onclick="this.closest('dialog').close()">Close</button>
                            </footer>
                        </div>
                    </dialog>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-gray-500 text-center mt-6">You havenâ€™t made any bookings yet.</p>
                {% endif %}
            </section>

            <section class="w-full max-w-5xl">
                <h3 class="text-3xl font-semibold mb-6 text-center">Pending Booking Requests</h3>

                {% if inbound_bookings %}
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    {% for booking in inbound_bookings %}
                    <div
                        class="card flex flex-col justify-between p-6 shadow-2xl rounded-2xl transition-transform duration-200 hover:-translate-y-1 hover:scale-[1.01]"
                    >
                        <header class="mb-3">
                            <h4 class="text-xl font-bold mb-1">
                                Booking #{{booking.id}}
                            </h4>
                            <p class="text-gray-600">
                                Listing ID: {{booking.listing_id}}
                            </p>
                        </header>

                        <section class="mb-4">
                            <p><strong>Guest ID:</strong> {{booking.guest_id}}</p>
                            <p><strong>Start Date:</strong> {{booking.start_date}}</p>
                            <p><strong>End Date:</strong> {{booking.end_date}}</p>
                            <p><strong>Status:</strong>
                                <span class="
                                    {% if booking.status == 'confirmed' %}text-green-600{% elif booking.status == 'pending' %}text-yellow-600{% else %}text-red-600{% endif %}
                                    font-semibold
                                ">
                                    {{booking.status | capitalize}}
                                </span>
                            </p>
                        </section>

                        <footer class="mt-auto flex justify-end gap-3">
                            {% if booking.status == 'pending' %}
                            <form action="/bookings/{{booking.id}}/confirm" method="POST">
                                <button class="btn text-sm bg-green-600 hover:bg-green-700">Confirm</button>
                            </form>
                            <form action="/bookings/{{booking.id}}/reject" method="POST">
                                <button class="btn-outline text-sm border-red-600 text-red-600 hover:bg-red-50">Reject</button>
                            </form>
                            {% else %}
                            <button class="btn-outline text-sm opacity-70 cursor-not-allowed" disabled>
                                {{booking.status | capitalize}}
                            </button>
                            {% endif %}
                        </footer>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-gray-500 text-center mt-6">You have no pending booking requests.</p>
                {% endif %}
            </section>
        </div>
    </div>
    {% endblock %}
</html>
